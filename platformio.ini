; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html
; ==============================================================
; BaseApp for Kode Dot (ESP32‑S3)
; Builds Arduino firmware and flashes app only (keeps bootloader/partitions).
; ==============================================================
[platformio]
; Default environment
default_envs = kode_dot

[env:kode_dot]
; Kode Dot target (ESP32‑S3)
; ESP32 platform (pinned stable)
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
; Board id (see boards/kode_dot.json)
board = kode_dot
framework = arduino
lib_compat_mode = off
monitor_speed = 115200
lib_ldf_mode = chain
; Serial monitor filters
monitor_filters = time, esp32_exception_decoder

build_flags = 
    -I src
    -DLV_CONF_INCLUDE_SIMPLE
    -Wno-deprecated-declarations
    -Wno-cpp

app_name = KodeDotSD
; Pre-build scripts
extra_scripts = pre:extra_scripts/auto_port.py, pre:extra_scripts/rename_bin.py
upload_protocol = esptool
upload_port = auto
monitor_port = auto
upload_speed = 460800
; Flash app at 0x400000 (preserve bootloader/partitions)
; Use modern esptool syntax (no .py; flags with dashes)
upload_command = esptool --chip esp32s3 --port ${UPLOAD_PORT} --baud ${UPLOAD_SPEED} write-flash --flash-freq 80m --flash-mode dio --flash-size 32MB 0x400000 "${BUILD_DIR}/${PROGNAME}.bin"

; Libraries - Basic LVGL setup
lib_deps =
  moononournation/GFX Library for Arduino @ ^1.6.0
  lvgl/lvgl @ ^9.0.0
  https://github.com/bitbank2/bb_captouch.git
  https://github.com/kodediy/kode_MAX31329.git